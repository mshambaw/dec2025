<form id="mpesaForm" style="max-width:400px;">
  <input type="tel" id="phone" placeholder="07XXXXXXXX" required
         class="form-control mb-2">

  <input type="number" id="amount" placeholder="Amount (KES)" required
         class="form-control mb-3">

  <button type="submit" class="btn btn-warning w-100">
    Donate via M-Pesa
  </button>

  <p id="status" class="mt-3"></p>
</form>

<script>
document.getElementById('mpesaForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  const phone = document.getElementById('phone').value;
  const amount = document.getElementById('amount').value;
  const status = document.getElementById('status');

  status.innerText = "üì≤ Check your phone to enter M-Pesa PIN...";

  try {
    const res = await fetch('/.netlify/functions/stkpush', {
      method: 'POST',
      body: JSON.stringify({ phone, amount })
    });

    const data = await res.json();
    status.innerText = data.message;
  } catch {
    status.innerText = "‚ùå Failed to send M-Pesa request.";
  }
});
</script>
